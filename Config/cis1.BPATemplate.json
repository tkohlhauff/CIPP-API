{
  "name": "CIS Analyzer - Asset Inventory and Passive Asset Discovery",
  "style": "Table",
  "Fields": [
    {
      "name": "CISControl1_1",
      "API": "Intune",
      "URL": "https://graph.microsoft.com/v1.0/deviceManagement/managedDevices",
      "Parameters": {
        "$filter": "enrolledDateTime ne null",
        "$select": "deviceId,deviceName,enrolledDateTime"
      },
      "StoreAs": "JSON",
      "FrontendFields": [
        {
          "name": "Intune Registered Devices",
          "formatter": "table",
          "value": "CISControl1_1"
        }
      ]
    },
    {
      "name": "CISControl1_5",
      "API": "Intune",
      "URL": "https://graph.microsoft.com/v1.0/deviceManagement/managedDevices",
      "Parameters": {
        "$filter": "enrolledDateTime ge " + sevenDaysAgo(),
        "$select": "deviceId,deviceName,enrolledDateTime"
      },
      "StoreAs": "JSON",
      "FrontendFields": [
        {
          "name": "New Intune Devices (Last 7 days)",
          "formatter": "table",
          "value": "CISControl1_5"
        }
      ]
    }
  ]
}

function sevenDaysAgo() {
  var today = new Date();
  var sevenDaysAgo = new Date(today);
  sevenDaysAgo.setDate(today.getDate() - 7);
  return formatDate(sevenDaysAgo);
}

function formatDate(date) {
  var year = date.getFullYear();
  var month = String(date.getMonth() + 1).padStart(2, '0');
  var day = String(date.getDate()).padStart(2, '0');
  return year + '-' + month + '-' + day;
}
